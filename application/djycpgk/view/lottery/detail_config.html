<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    {css href="/static/admin/css/style.css" /}
    {js href="/static/admin/js/jquery-3.2.1.min.js" /}
    {js href="/static/admin/layer/layer.js" /}
    {js href="/static/admin/js/jquery.idTabs.min.js" /}
    <style type="text/css">

    .tongyi {
    width: 100px;
    margin-top: 10px;
    }
    </style>
    <script type="text/javascript">
    $(document).ready(function(){
    $(".click").click(function(){
    $(".tip").fadeIn(200);
    });
    $(".odds_setting").click(function(){
    var type_key = $(this).attr('data-type');
    var type_id = $(this).attr('data-id');
    var type_name = $(this).attr('data-name');
    var type_gf = $(this).attr('data-gf');

	
    layer.open({
    type: 2,
    skin: 'layui-layer-rim', //加上边框
    title:type_name+' (赔率自定义)',
    area: ['950px', '580px'], //宽高
    content: "{:url('djycpgk/lottery/odds_setting')}?type_id="+type_id+"&type_key="+type_key+"&type_gf="+type_gf,
    });
    })
    $('.tb_peilv').click(function(){
    var type =  $("input[name='type_id']").val();
    $.ajax({
    url:"{:url('djycpgk/lottery/tb_peilv')}",//这里指向的就不再是页面了，而是一个方法。
    data:{type:type},
    type:"POST",
    dataType:"JSON",
    success: function(data){
    if(data.error == 0){
    layer.msg(data.msg,{icon:1,time:1000},function(){
    self.location.reload(); // 父页面刷新
    self.layer.close();
    });
    }else{
    layer.msg(data.msg, {icon: 5,time:2000});
    }
    }
    })
    })
    });
    </script>
    <style>

    .switch {
    position: relative;
    margin: 20px auto;
    height: 26px;
    width: 120px;
    background: rgba(0, 0, 0, 0.25);
    border-radius: 3px;
    -webkit-box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);
    }
    .switch-label {
    position: relative;
    z-index: 2;
    float: left;
    width: 58px;
    line-height: 26px;
    font-size: 11px;
    color: rgba(255, 255, 255, 0.35);
    text-align: center;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.45);
    cursor: pointer;
    }
    .switch-label:active {
    font-weight: bold;
    }
    .switch-label-off {
    padding-left: 2px;
    }
    .switch-label-on {
    padding-right: 2px;
    }
    /*
    * Note: using adjacent or general sibling selectors combined with
    *       pseudo classes doesn't work in Safari 5.0 and Chrome 12.
    *       See this article for more info and a potential fix:
    *       http://css-tricks.com/webkit-sibling-bug/
    */
    .switch-input {
    display: none;
    }
    .switch-input:checked + .switch-label {
    font-weight: bold;
    color: rgba(0, 0, 0, 0.65);
    text-shadow: 0 1px rgba(255, 255, 255, 0.25);
    -webkit-transition: 0.15s ease-out;
    -moz-transition: 0.15s ease-out;
    -o-transition: 0.15s ease-out;
    transition: 0.15s ease-out;
    }
    .switch-input:checked + .switch-label-on ~ .switch-selection {
    left: 60px;
    /* Note: left: 50% doesn't transition in WebKit */
    }
    .switch-selection {
    display: block;
    position: absolute;
    z-index: 1;
    top: 2px;
    left: 2px;
    width: 58px;
    height: 22px;
    background: #65bd63;
    border-radius: 3px;
    background-image: -webkit-linear-gradient(top, #9dd993, #65bd63);
    background-image: -moz-linear-gradient(top, #9dd993, #65bd63);
    background-image: -o-linear-gradient(top, #9dd993, #65bd63);
    background-image: linear-gradient(to bottom, #9dd993, #65bd63);
    -webkit-box-shadow: inset 0 1px rgba(255, 255, 255, 0.5), 0 0 2px rgba(0, 0, 0, 0.2);
    box-shadow: inset 0 1px rgba(255, 255, 255, 0.5), 0 0 2px rgba(0, 0, 0, 0.2);
    -webkit-transition: left 0.15s ease-out;
    -moz-transition: left 0.15s ease-out;
    -o-transition: left 0.15s ease-out;
    transition: left 0.15s ease-out;
    }
    .switch-blue .switch-selection {
    background: #3aa2d0;
    background-image: -webkit-linear-gradient(top, #4fc9ee, #3aa2d0);
    background-image: -moz-linear-gradient(top, #4fc9ee, #3aa2d0);
    background-image: -o-linear-gradient(top, #4fc9ee, #3aa2d0);
    background-image: linear-gradient(to bottom, #4fc9ee, #3aa2d0);
    }
    .switch-yellow .switch-selection {
    background: #c4bb61;
    background-image: -webkit-linear-gradient(top, #e0dd94, #c4bb61);
    background-image: -moz-linear-gradient(top, #e0dd94, #c4bb61);
    background-image: -o-linear-gradient(top, #e0dd94, #c4bb61);
    background-image: linear-gradient(to bottom, #e0dd94, #c4bb61);
    }
    .cp_content ul li{
    width: 23%;
    float: left;
    text-align: center;
    border-top: solid 1px #a7b5bc;
    border-left: solid 1px #a7b5bc;
    border-right: solid 1px #ced9df;
    border-bottom: solid 1px #ced9df;
    margin-left: 5px;
    margin-top: 5px;
    }
    .cp_content .type_name  input{
    width: 70px;
    border-bottom: solid 1px #ced9df;
    font-size: 15px;
    font-weight: bolder;
    letter-spacing: 2px;
    /* padding-top: 4px; */
    height: 16px;
    text-align: center;
    }
    .cp_content .detail_config a{
    color: #3EAFE0;
    }
    .batch label{
    display: inline-block;
    width: 50px;
    height: 30px;
    text-align: right;
    }
    #kg2{
        margin-left: 0px;
    }
    #kg{
        margin-left: 0px;
    }
    .bonus_box_out {
      display: flex;
      flex-wrap: wrap;
    }
    .bonus_box {
      display: flex;
      margin: 5px;
      line-height: 30px;
      border: 1px solid #dfe7ea;
      border-radius: 5px;
    }
    .s_icon {
      width: 100px;
      height: 100px;
    }
    .b_i {
      height: 20px;
      margin-top: 0;
      border-radius: 3px;

    }
    .b_box {
      padding: 5px;
    }
    .title {
      background: #edf6fa;
      padding: 10px;
    }
    .room_item {
      margin: 0 5px;
    }
    .num_out {
      position: relative;
    }
    .bian {
      position: absolute;
      left: 6px;
      top: 6px;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      border-radius: 5px 0 5px 0;
      padding: 2px 10px;
    }
    </style>
  </head>
  <body>
      <div class="place">
            <div class="ibox-content" style="margin-left: 30px;">
                <div class="place">
                <span>位置：</span>
                <ul class="placeul">
                <li><a href="{:url('/djycpgk/lottery/statussetting')}?category={$cate}">彩种设置</a></li>
                <li><a href="#">{$name}：玩法设置</a></li>
                </ul>
                </div>
            </div>
    <div class="rightinfo">
      <div class="formbody">
        {if $data['type']==56}


        {else/}

        {/if}
        <div id="usual1" class="usual">
          <div class="itab">
            <ul>
              {if !in_array($data.type,['24','25','26','27','53','54','55','56'])}  <li><a href="#tab1">批量设置</a></li> {/if}
              <li><a href="#tab2" >详细设置</a></li>
              {if condition="isset($is_official) AND $is_official==1"}  <li><a href="#tab3">官方玩法</a></li> {/if}
            </ul>
          </div>
          {if condition="isset($is_official) AND $is_official==1"}
          <div id="tab3" class="tabson">
              <div class="cp_content">
                  <form action="{:url('djycpgk/lottery/detail_config')}" method="post">
                      <input type="hidden" name="type_id" value="{$type}" />
					  <input type="hidden" name="type_gf" value="gf" />
                      <ul>
                          {volist name="data.official" id="vo"  key='k'}
                          <li>
                              <p class="type_name"><input type="text"  name="name[]" value="{$vo.name}" /></p>
                              <div class="switch switch-blue">
                                  <input type="radio" class="switch-input" name="switch[{$k}]" value="1" id="week2{$k}" {if $vo['switch'] == 1}checked='checked'{/if}>
                                  <label for="week2{$k}" class="switch-label switch-label-off">开</label>
                                  <input type="radio" class="switch-input" name="switch[{$k}]" value="0" id="month2{$k}" {if $vo['switch'] == 0}checked='checked'{/if}>
                                  <label for="month2{$k}" class="switch-label switch-label-on">关</label>
                                  <span class="switch-selection" id="kg2"></span>
                              </div>
						
							<p class="detail_config"><a href="javascript:;"  class="odds_setting" data-gf="gf" data-type="{$vo.key_name}" data-id="{$type}" data-name="{$vo.name}">赔率设置</a></p>
							
                           
                          </li>
                          {/volist}
                      </ul>
                      <div style="clear: both; text-align: center;"><br /><br />
                          <input type="submit" class="btn" value="保存" />&nbsp;&nbsp;
                      </div>
                  </form>
              </div>
          </div>
          {/if}
          <div id="tab1" class="tabson">
            {if !in_array($data.type,['24','25','26','27','53','54','55','56'])}
            <p>统一设置 (总和、冠军、亚军、第一球到第五球等..，相同结果的赔率)<b style="color: red;">*特殊玩法请到详细设置中，单独设置</b></p>
            <form action="{:url('djycpgk/lottery/batch_config')}" method="post"  class="batch">

              <input type="hidden" name="type_id" value="{$data.type}" />
              <label>大:</label>&nbsp;<input type="text" class="dfinput tongyi" name="da" value="" >倍<br>
              <label>小:</label>&nbsp;<input type="text" class="dfinput tongyi" name="x" value="">倍<br>
              <label>单:</label>&nbsp;<input type="text" class="dfinput tongyi" name="dan" value="">倍<br>
              <label>双:</label>&nbsp;<input type="text" class="dfinput tongyi" name="s" value="">倍<br>
              <label>数字:</label>&nbsp;<input type="text" class="dfinput tongyi" name="code" value="">倍<br>
              {if $data.type == '52'}
                <label>大双:</label>&nbsp;<input type="text" class="dfinput tongyi" name="ds" value="">倍<br>
                <label>大单:</label>&nbsp;<input type="text" class="dfinput tongyi" name="dd" value="">倍<br>
                <label>小双:</label>&nbsp;<input type="text" class="dfinput tongyi" name="xs" value="">倍<br>
                <label>小单:</label>&nbsp;<input type="text" class="dfinput tongyi" name="xd" value="">倍<br>
                {else/}
                <label>龙:</label>&nbsp;<input type="text" class="dfinput tongyi" name="l" value="">倍<br>
                <label>虎:</label>&nbsp;<input type="text" class="dfinput tongyi" name="hu" value="">倍<br>
              {/if}



              <div style="clear: both; text-align: center;"><br /><br /><input type="submit" class="btn" value="保存" /></div>
            </form>
            {/if}
          </div>
          <div id="tab2" class="tabson">
            <!--拉拔-->
            {if in_array($data.type,[53, 54, 55])}
            <input type="text"  class="dfinput" name="tongbu" data-id="{$type_id}" style="width: 100px;height: 30px;">
            <b>连中: 3个</b>
            <input type="button" class="btn btn_tongbu"  value="同步"  style="width: 50px;height: 30px;" />

            <input type="text"  class="dfinput" name="tongbu2" data-id="{$type_id}" style="width: 100px;height: 30px;">
            <b>连中: 4个</b>
            <input type="button" class="btn btn_tongbu2"  value="同步"  style="width: 50px;height: 30px;" />

            <input type="text"  class="dfinput" name="tongbu3" data-id="{$type_id}" style="width: 100px;height: 30px;">
            <b>连中: 5个</b>
            <input type="button" class="btn btn_tongbu3"  value="同步"  style="width: 50px;height: 30px;" />

              <input type="hidden" data-parent='["img_dir"]' value="{$config.img_dir}">

              <div class="title">房间设置</div>
              <div class="tools">
                <ul class="toolbar">
                  <li class="click addRule"><span><img src="/static/admin/images/t01.png"/></span>添加</li>
                </ul>
              </div>
              <div class="bonus_box_out" style="margin-bottom: 10px;">
                {foreach $config.room as $key => $item}
                  <div class="room_item">
                    <span class="dtl_rule"><img src="/static/admin/images/t03.png"/></span>
                    <input type="text" data-parent='["room", {$key}]' class="dfinput tongyi" value="{$item}"> 元房
                  </div>
                {/foreach}
                <p class="baocun"></p>
              </div>
              <div class="title">中奖配置（控制每个号码的出现次数来调整中奖奖金）</div>
              <div>
                <div style="padding: 5px;font-size: 16px;color: #f22">
                    调整下面每个编号下的出现次数(每条滚轮)
                </div>
              </div>
              <div class="title">奖金设置</div>
              <div class="bonus_box_out">
              {foreach $config.bonus as $key => $value}
              <div class="num_out">
                <div class="bian">编:{$key}</div>
                <div class="bonus_box">
                  <img class="s_icon" src="{$config.img_dir}/{$key}.png" alt="">
                  <div class="b_box">
                      <div>出现次数: <input type="text"  data-parent='["li", "{$key}"]' class="b_i dfinput tongyi" value="{$config.li[$key]}"></div>
                      {foreach $value as $num => $bonus}
                        <div>连中: {$num}个 | 倍数: <input type="text"  data-parent='["bonus", "{$key}", "{$num}"]' class="b_i dfinput tongyi tobu{$num}" value="{$bonus}"></div>
                      {/foreach}
                  </div>
                </div>
              </div>
              {/foreach}
              </div>
              <div style="text-align: center;">
                <br>
                <input type="submit" data-type="{$data.type}" class="btn config_save" value="保存" />
              </div>
            <!--老虎机-->
            {elseif  $data.type==56 }
            <div class="title">房间设置</div>
            <div class="tools">
              <ul class="toolbar">
                <li class="click addRule"><span><img src="/static/admin/images/t01.png"/></span>添加</li>
              </ul>
            </div>
              <div class="bonus_box_out" style="margin-bottom: 10px;">
                {foreach $config.room as $key => $item}
                <div class="room_item">
                  <span class="dtl_rule"><img src="/static/admin/images/t03.png"/></span>
                  <input type="text" data-parent='["room", {$key}]' class="dfinput tongyi" value="{$item}"> 元房
                </div>
                {/foreach}
                <p class="baocun"></p>
              </div>
              <label>回报率设置:（设置的越低中奖几率越低,推荐几率80% ）</label>&nbsp;<input data-parent='["percent"]' type="number" class="dfinput tongyi"
                                                onchange="if(!/^(\d{1,2}(\.\d+)?|100|NA)$/.test(value)){value='';alert('输入格式不正确!');}"
                                                name="da" value="{$data.basic_config.percent}" >%<br>
              <div style="text-align: center;">
                <br>
                <input type="submit" data-type="{$data.type}" class="btn config_save" value="保存" />
              </div>




            {else/}

            <div class="cp_content">
              <form action="{:url('djycpgk/lottery/detail_config')}" method="post">
                <input type="hidden" name="type_id" value="{$data.type}" />
                <ul>

                  {volist name="data.basic_config" id="vo"  key='k'}
                  <li>
                    <p class="type_name"><input type="text"  name="name[]" value="{$vo.name}" /></p>
                    <div class="switch switch-blue">
                      <input type="radio" class="switch-input" name="switch[{$k}]" value="1" id="week{$k}" {if $vo['switch'] == 1}checked='checked'{/if}>
                      <label for="week{$k}" class="switch-label switch-label-off">开</label>
                      <input type="radio" class="switch-input" name="switch[{$k}]" value="0" id="month{$k}" {if $vo['switch'] == 0}checked='checked'{/if}>
                      <label for="month{$k}" class="switch-label switch-label-on">关</label>
                      <span class="switch-selection" id="kg"></span>
                    </div>
                    <p class="type_name"><b style="margin-left: 20px;">允许下注数：</b><input type="text"  name="number[]" value="{$vo.number}" /></p>
                    <p class="detail_config"><a href="javascript:;"  class="odds_setting"  data-type="{$vo.key_name}" data-id="{$type}" data-name="{$vo.name}">赔率设置</a></p>

                  </li>
                  {/volist}
                </ul>

                <div style="clear: both; text-align: center;"><br /><br /><input type="submit" class="btn" value="保存" />&nbsp;&nbsp;
                {if !in_array($data.type,['11','19','21','22','29'])}<input type="button" class="btn tb_peilv" value="同类彩票赔率同步" />{/if}</div>


              </form>
            </div>
            {/if}
          </div>
        </div>

    </div>
      </div>
    </div>

    <script type="text/javascript">
    $("#usual1 ul").idTabs();


    var parseConfig = function() {
      var config = {};
      $('input[data-parent]').each(function() {
        var $this = $(this);
        var key = $this.data('parent');
        var cache = config;
        var _cache = {};
        for (var i = 0; i < key.length; i ++) {
          var k = key[i];
          if (!cache[k]) {
            cache[k] = {};
          }
          if (i == key.length - 1) {
            cache[k] = $this.val();
          } else {
            cache = cache[k];
          }
        }
      });
      return config;
    }
    $('.config_save').click(function() {
      var config_str = JSON.stringify(parseConfig());
      $.post('/djycpgk/lottery/saveJsonConfig', {
        type: $(this).data('type'),
        json: config_str
      }).then(function(data) {
        if (data.code) {
          layer.alert(data.msg, {
            icon: 5
          })
        } else {
          layer.msg(data.msg);
        }
      });

    });

    $(".btn_tongbu").click(function(){
        var tongbu = $("input[name='tongbu']").val();
        if(tongbu == ''){
            layer.msg('请输入同步数字');
            return;
        }
        $('.tobu3').val(tongbu);
    })
    $(".btn_tongbu2").click(function(){
        var tongbu = $("input[name='tongbu2']").val();
        if(tongbu == ''){
            layer.msg('请输入同步数字');
            return;
        }
        $('.tobu4').val(tongbu);
    })
    $(".btn_tongbu3").click(function(){
        var tongbu = $("input[name='tongbu3']").val();
        if(tongbu == ''){
            layer.msg('请输入同步数字');
            return;
        }
        $('.tobu5').val(tongbu);
    })

    $(".addRule").click(function () {
        var length = $('.room_item input').length;
        var html = '';
        html += ' <div class="room_item">';
        html += '<span class="dtl_rule"><img src="/static/admin/images/t03.png"/></span>';
        html += '<input type="text" data-parent=\'["room", ' + length + ']\' class="dfinput tongyi" value=""> 元房';
        html += '</div>';
        $('.baocun').before(html);
    })

    $(document).on('click', '.dtl_rule', function () {
        $(this).parent().remove();
    })
    </script>
  </body>
</html>
